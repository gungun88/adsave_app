# å®å¡”é¢æ¿ Redis é›†æˆæŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨åœ¨å®å¡”é¢æ¿ç¯å¢ƒä¸­å®‰è£…å’Œé…ç½® Redisï¼Œä»¥æå‡ AdSave.app çš„æ€§èƒ½ã€‚

## âœ¨ ä½¿ç”¨ Redis çš„ä¼˜åŠ¿

### å¯¹æ¯”å†…å­˜ç¼“å­˜ï¼š

| ç‰¹æ€§ | å†…å­˜ç¼“å­˜ | Redis ç¼“å­˜ |
|------|----------|-----------|
| **æŒä¹…åŒ–** | âŒ æœåŠ¡å™¨é‡å¯ä¸¢å¤± | âœ… æ•°æ®æŒä¹…åŒ–ä¿å­˜ |
| **å¤šå®ä¾‹å…±äº«** | âŒ æ— æ³•å…±äº« | âœ… å¤šä¸ªåç«¯å®ä¾‹å…±äº«ç¼“å­˜ |
| **ç¼“å­˜ç®¡ç†** | âš ï¸ æ‰‹åŠ¨æ¸…ç† | âœ… è‡ªåŠ¨è¿‡æœŸç®¡ç† |
| **æ€§èƒ½** | âœ… æå¿« | âœ… éå¸¸å¿« |
| **éƒ¨ç½²å¤æ‚åº¦** | âœ… ç®€å• | âš ï¸ éœ€è¦å®‰è£… Redis |

---

## ğŸš€ åœ¨å®å¡”é¢æ¿å®‰è£… Redis

### ç¬¬ä¸€æ­¥ï¼šå®‰è£… Redis æœåŠ¡

1. **ç™»å½•å®å¡”é¢æ¿**
   ```
   http://ä½ çš„æœåŠ¡å™¨IP:8888
   ```

2. **å®‰è£… Redis**
   - è¿›å…¥ï¼š**è½¯ä»¶å•†åº—** â†’ **è¿è¡Œç¯å¢ƒ**
   - æœç´¢ï¼š**Redis**
   - ç‚¹å‡» **å®‰è£…**ï¼ˆæ¨èç‰ˆæœ¬ 7.x æˆ– 6.xï¼‰

3. **å¯åŠ¨ Redis æœåŠ¡**
   - å®‰è£…å®Œæˆåï¼Œç‚¹å‡» **è®¾ç½®**
   - ç¡®ä¿æœåŠ¡çŠ¶æ€ä¸º **è¿è¡Œä¸­**
   - æŸ¥çœ‹ç«¯å£å·ï¼ˆé»˜è®¤ 6379ï¼‰

### ç¬¬äºŒæ­¥ï¼šé…ç½® Redis å®‰å…¨

1. **è®¾ç½®å¯†ç ï¼ˆæ¨èï¼‰**
   - åœ¨ Redis è®¾ç½®ä¸­ç‚¹å‡» **é…ç½®ä¿®æ”¹**
   - æ‰¾åˆ° `requirepass` è¡Œ
   - å–æ¶ˆæ³¨é‡Šå¹¶è®¾ç½®å¯†ç ï¼š
     ```
     requirepass your_strong_password_here
     ```
   - ä¿å­˜å¹¶é‡å¯ Redis

2. **é˜²ç«å¢™è®¾ç½®**
   - å¦‚æœåªåœ¨æœ¬åœ°ä½¿ç”¨ï¼Œæ— éœ€å¼€æ”¾å¤–ç½‘ç«¯å£
   - Redis é»˜è®¤ç»‘å®š `127.0.0.1`ï¼Œåªå…è®¸æœ¬æœºè®¿é—®

---

## ğŸ“¦ éƒ¨ç½²æ­¥éª¤

### ç¬¬ä¸‰æ­¥ï¼šå®‰è£… Node.js ä¾èµ–

1. **SSH è¿æ¥æœåŠ¡å™¨**
   ```bash
   ssh root@ä½ çš„æœåŠ¡å™¨IP
   ```

2. **è¿›å…¥é¡¹ç›®åç«¯ç›®å½•**
   ```bash
   cd /www/wwwroot/adsave_app/backend
   ```

3. **å®‰è£…æ–°ä¾èµ–**
   ```bash
   npm install
   ```

### ç¬¬å››æ­¥ï¼šé…ç½®ç¯å¢ƒå˜é‡

1. **åˆ›å»º .env æ–‡ä»¶**
   ```bash
   nano .env
   ```

2. **æ·»åŠ é…ç½®**ï¼ˆå¤åˆ¶ .env.exampleï¼‰
   ```bash
   # Redis Configuration
   REDIS_HOST=localhost
   REDIS_PORT=6379
   REDIS_PASSWORD=your_redis_password_here
   REDIS_DB=0

   # Cache TTL (in seconds, 300 = 5 minutes)
   CACHE_TTL=300

   # Server Port
   PORT=3001
   ```

3. **ä¿å­˜æ–‡ä»¶**
   - æŒ‰ `Ctrl + X`
   - è¾“å…¥ `Y` ç¡®è®¤
   - æŒ‰ `Enter` ä¿å­˜

### ç¬¬äº”æ­¥ï¼šé‡å¯åç«¯æœåŠ¡

1. **ä½¿ç”¨ PM2 é‡å¯**
   ```bash
   pm2 restart adsave-backend
   pm2 logs adsave-backend
   ```

2. **æ£€æŸ¥æ—¥å¿—**
   å¯åŠ¨æˆåŠŸä¼šçœ‹åˆ°ï¼š
   ```
   [Cache] Redis enabled
   [Redis] Connected to Redis server
   [Redis] Redis client ready
   Backend server running on http://localhost:3001
   ```

---

## ğŸ§ª æµ‹è¯• Redis ç¼“å­˜

### æµ‹è¯•æ­¥éª¤ï¼š

1. **ç¬¬ä¸€æ¬¡è§£æè§†é¢‘**
   - æ‰“å¼€å‰ç«¯ç½‘ç«™
   - è¾“å…¥ Facebook å¹¿å‘Šé“¾æ¥
   - ç‚¹å‡»è§£æï¼Œè®°å½•æ—¶é—´ï¼ˆçº¦ 10 ç§’ï¼‰

2. **æŸ¥çœ‹åç«¯æ—¥å¿—**
   ```bash
   pm2 logs adsave-backend --lines 20
   ```

   åº”è¯¥çœ‹åˆ°ï¼š
   ```
   [Start] Processing: https://...
   [Perf] Total processing time: 10200ms
   [Cache] Redis saved: https://...
   ```

3. **ç¬¬äºŒæ¬¡è§£æåŒä¸€é“¾æ¥**
   - å†æ¬¡è§£æç›¸åŒé“¾æ¥
   - åº”è¯¥ç¬é—´è¿”å›ï¼ˆ< 100msï¼‰

4. **æ—¥å¿—æ˜¾ç¤ºç¼“å­˜å‘½ä¸­**
   ```
   [Cache] Hit! Returning cached data
   [Perf] Cache retrieval: 2ms
   ```

---

## ğŸ”§ Redis ç®¡ç†

### é€šè¿‡å®å¡”é¢æ¿ç®¡ç†

1. **æŸ¥çœ‹ Redis çŠ¶æ€**
   - è½¯ä»¶å•†åº— â†’ Redis â†’ è®¾ç½®
   - å¯ä»¥çœ‹åˆ°ï¼š
     - è¿è¡ŒçŠ¶æ€
     - å†…å­˜ä½¿ç”¨
     - è¿æ¥æ•°

2. **æ¸…ç©ºç¼“å­˜**
   ```bash
   redis-cli FLUSHDB
   ```

   å¦‚æœè®¾ç½®äº†å¯†ç ï¼š
   ```bash
   redis-cli -a your_password FLUSHDB
   ```

3. **æŸ¥çœ‹ç¼“å­˜é”®**
   ```bash
   redis-cli KEYS "*facebook.com*"
   ```

### å¸¸ç”¨ Redis å‘½ä»¤

```bash
# æŸ¥çœ‹æ‰€æœ‰é”®
redis-cli KEYS "*"

# æŸ¥çœ‹æŸä¸ªé”®çš„å€¼
redis-cli GET "https://www.facebook.com/ads/library/?id=123"

# æŸ¥çœ‹é”®çš„è¿‡æœŸæ—¶é—´
redis-cli TTL "https://www.facebook.com/ads/library/?id=123"

# åˆ é™¤æŸä¸ªé”®
redis-cli DEL "https://www.facebook.com/ads/library/?id=123"
```

---

## âš ï¸ æ•…éšœæ’æŸ¥

### Redis æ— æ³•è¿æ¥

**ç—‡çŠ¶**ï¼šæ—¥å¿—æ˜¾ç¤º `Redis not available, using memory cache`

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥ Redis æ˜¯å¦è¿è¡Œï¼š
   ```bash
   systemctl status redis
   ```

2. æ£€æŸ¥ç«¯å£æ˜¯å¦ç›‘å¬ï¼š
   ```bash
   netstat -tlnp | grep 6379
   ```

3. æµ‹è¯•è¿æ¥ï¼š
   ```bash
   redis-cli ping
   # åº”è¯¥è¿”å›: PONG
   ```

### å¯†ç è®¤è¯å¤±è´¥

**ç—‡çŠ¶**ï¼š`[Redis] Redis error: NOAUTH Authentication required`

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥ `.env` æ–‡ä»¶ä¸­çš„å¯†ç æ˜¯å¦æ­£ç¡®
2. ç¡®è®¤ Redis é…ç½®ä¸­çš„ `requirepass` ä¸ `.env` ä¸€è‡´

### å†…å­˜ä¸è¶³

**ç—‡çŠ¶**ï¼šRedis å ç”¨å†…å­˜è¿‡é«˜

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. åœ¨ Redis é…ç½®ä¸­è®¾ç½®æœ€å¤§å†…å­˜ï¼š
   ```
   maxmemory 256mb
   maxmemory-policy allkeys-lru
   ```

2. å‡å°‘ç¼“å­˜æ—¶é—´ï¼ˆä¿®æ”¹ `.env` ä¸­çš„ `CACHE_TTL`ï¼‰

---

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

### ä½¿ç”¨ Redis å‰åå¯¹æ¯”ï¼š

| åœºæ™¯ | å†…å­˜ç¼“å­˜ | Redis ç¼“å­˜ |
|------|----------|-----------|
| é¦–æ¬¡è§£æ | ~10s | ~10s |
| ç¼“å­˜å‘½ä¸­ | <100ms | <100ms |
| **æœåŠ¡å™¨é‡å¯å** | âŒ ç¼“å­˜ä¸¢å¤±ï¼Œé‡æ–°è§£æ | âœ… ç¼“å­˜ä¿ç•™ï¼Œç¬é—´è¿”å› |
| **å¤šå®ä¾‹éƒ¨ç½²** | âŒ å„è‡ªç‹¬ç«‹ç¼“å­˜ | âœ… å…±äº«ç¼“å­˜æ±  |

---

## ğŸ¯ æ¨èé…ç½®

### ç”Ÿäº§ç¯å¢ƒé…ç½®ï¼š

```bash
# .env
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=strong_password_here
REDIS_DB=0
CACHE_TTL=600  # 10 åˆ†é’Ÿç¼“å­˜
PORT=3001
```

### å¼€å‘ç¯å¢ƒé…ç½®ï¼š

```bash
# .env
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0
CACHE_TTL=300  # 5 åˆ†é’Ÿç¼“å­˜
PORT=3001
```

---

## ğŸ”„ å›é€€åˆ°å†…å­˜ç¼“å­˜

å¦‚æœä¸æƒ³ä½¿ç”¨ Redisï¼Œåªéœ€ï¼š

1. **ä¸å®‰è£… Redis** æˆ– **åœæ­¢ Redis æœåŠ¡**
2. ç³»ç»Ÿä¼šè‡ªåŠ¨å›é€€åˆ°å†…å­˜ç¼“å­˜
3. æ—¥å¿—æ˜¾ç¤ºï¼š`[Cache] Redis not available, using memory cache`

**æ— éœ€ä¿®æ”¹ä»£ç **ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨é™çº§ï¼

---

## âœ… å®Œæˆ

æŒ‰ç…§ä»¥ä¸Šæ­¥éª¤ï¼Œæ‚¨çš„ AdSave.app ç°åœ¨å·²ç»é›†æˆäº† Redis ç¼“å­˜ï¼Œäº«å—æ›´å¿«çš„å“åº”é€Ÿåº¦å’Œæ›´å¥½çš„ç¼“å­˜ç®¡ç†ï¼

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. âœ… Redis æœåŠ¡æ˜¯å¦è¿è¡Œ
2. âœ… `.env` æ–‡ä»¶é…ç½®æ˜¯å¦æ­£ç¡®
3. âœ… `npm install` æ˜¯å¦æˆåŠŸå®‰è£… `ioredis`
4. âœ… åç«¯æ—¥å¿—æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯
